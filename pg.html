<!DOCTYPE html>
<html lang="en">
  <html lang="en">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Combined Crypto Alerts</title>
      <link rel="stylesheet" href="style.css">
  <style>
    .token-section {
      margin: 2rem;
      padding: 1rem;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    .price-container p {
      font-size: 1.2rem;
      margin: 0.5rem 0;
    }
    .alert-positive { color: green; }
    .alert-negative { color: red; }
    .alert-flashing-1 { animation: flash 1s infinite; }
    .alert-flashing-2 { animation: flash 0.5s infinite; }
    .alert-flashing-negative-1 { animation: flash-red 1s infinite; }
    .alert-flashing-negative-2 { animation: flash-red 0.5s infinite; }
    .alert-large-green { background: green; color: white; padding: 4px; }
    .alert-large-red { background: red; color: white; padding: 4px; }

    @keyframes flash {
      0%, 100% { background-color: transparent; }
      50% { background-color: lightgreen; }
    }
    @keyframes flash-red {
      0%, 100% { background-color: transparent; }
      50% { background-color: pink; }
    }
  </style>
</head>
<body>
  <div class="token-section">
    <h2>GFM Alerts</h2>
    <div class="price-container">
      <p>Buy Alert: <span id="gfm-buy-alert" aria-live="polite">Loading...</span></p>
      <p>Sell Alert: <span id="gfm-sell-alert" aria-live="polite">Loading...</span></p>
    </div>
  </div>

  <div class="token-section">
    <h2>Pasternak Alerts</h2>
    <div class="price-container">
      <p>Buy Alert: <span id="pasternak-buy-alert" aria-live="polite">Loading...</span></p>
      <p>Sell Alert: <span id="pasternak-sell-alert" aria-live="polite">Loading...</span></p>
    </div>
  </div>

<script>
const tokens = {
  gfm: {
    mexcApiUrl: 'https://contract.mexc.com/api/v1/contract/depth/GFM_USDT',
    jupConfig: {
      inputMintUSDC: 'EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v',
      outputMint: 'E1jCTXdkMRoawoWoqfbhiNkkLbxcSHPssMo36U84pump',
      buySwap: { amount: 300, decimals: 6 },  // USDC -> GFM (6 decimals)
      sellSwap: { amount: 5000, decimals: 6 } // GFM -> USDC (6 decimals)
    },
    elements: {
      buy: document.getElementById('gfm-buy-alert'),
      sell: document.getElementById('gfm-sell-alert')
    }
  },
  pasternak: {
    mexcApiUrl: 'https://contract.mexc.com/api/v1/contract/depth/PASTERNAK_USDT',
    jupConfig: {
      inputMintUSDC: 'EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v',
      outputMint: 'Ey59PH7Z4BFU4HjyKnyMdWt5GGN76KazTAwQihoUXRnk',
      buySwap: { amount: 300, decimals: 9 }, // Changed from 6 to 9 ðŸ«·
      sellSwap: { amount: 9000, decimals: 9 }
    },
    elements: {
      buy: document.getElementById('pasternak-buy-alert'),
      sell: document.getElementById('pasternak-sell-alert')
    }
  }
};

async function fetchMexcPrice(apiUrl) {
  try {
    const proxyUrl = 'https://api.codetabs.com/v1/proxy/?quest=';
    const response = await fetch(proxyUrl + apiUrl);
    const data = await response.json();
    return {
      bid: parseFloat(data.data.bids[0][0]),
      ask: parseFloat(data.data.asks[0][0])
    };
  } catch (error) {
    console.error('MEXC Error:', error);
    return null;
  }
}

async function fetchJupSwapPrice(inputMint, outputMint, amount, decimals) {
  try {
    const url = `https://quote-api.jup.ag/v6/quote?inputMint=${inputMint}&outputMint=${outputMint}&amount=${amount}`;
    const response = await fetch(url);
    const data = await response.json();
    return data.outAmount / 10 ** decimals;
  } catch (error) {
    console.error('JUP Error:', error);
    return null;
  }
}

async function fetchTokenPrices(tokenConfig) {
  try {
    const [mexcPrices, jupBuy, jupSell] = await Promise.all([
      fetchMexcPrice(tokenConfig.mexcApiUrl),
      fetchJupSwapPrice(
        tokenConfig.jupConfig.inputMintUSDC,
        tokenConfig.jupConfig.outputMint,
        tokenConfig.jupConfig.buySwap.amount * 10 ** 6, // USDC always has 6 decimals
        tokenConfig.jupConfig.buySwap.decimals
      ),
      fetchJupSwapPrice(
        tokenConfig.jupConfig.outputMint,
        tokenConfig.jupConfig.inputMintUSDC,
        tokenConfig.jupConfig.sellSwap.amount * 10 ** tokenConfig.jupConfig.sellSwap.decimals,
        6 // USDC output uses 6 decimals
      )
    ]);

    if (!mexcPrices || !jupBuy || !jupSell) return null;

    return {
      buyRate: tokenConfig.jupConfig.buySwap.amount / jupBuy,
      sellRate: jupSell / tokenConfig.jupConfig.sellSwap.amount,
      mexcBid: mexcPrices.bid,
      mexcAsk: mexcPrices.ask
    };
  } catch (error) {
    console.error('Price fetch error:', error);
    return null;
  }
}

function applyAlertStyles(element, difference) {
  element.className = '';
  element.style.cssText = '';

  const absDiff = Math.abs(difference);
  const isPositive = difference > 0;

  if (absDiff > 0.003) {
    element.style.fontSize = '2em';
    element.classList.add(isPositive ? 'alert-flashing-2' : 'alert-flashing-negative-2');
  } else if (absDiff > 0.002) {
    element.style.fontSize = '1.5em';
    element.classList.add(isPositive ? 'alert-flashing-1' : 'alert-flashing-negative-1');
  } else if (absDiff > 0.001) {
    element.classList.add(isPositive ? 'alert-large-green' : 'alert-large-red');
  } else {
    element.classList.add(isPositive ? 'alert-positive' : 'alert-negative');
  }
}

async function updateTokenAlerts(tokenKey) {
  const config = tokens[tokenKey];
  const prices = await fetchTokenPrices(config);
  
  if (!prices) {
    config.elements.buy.textContent = 'Error';
    config.elements.sell.textContent = 'Error';
    return;
  }

  const buyDiff = prices.mexcBid - prices.buyRate;
  const sellDiff = prices.sellRate - prices.mexcAsk;

  config.elements.buy.textContent = buyDiff.toFixed(5);
  config.elements.sell.textContent = sellDiff.toFixed(5);

  applyAlertStyles(config.elements.buy, buyDiff);
  applyAlertStyles(config.elements.sell, sellDiff);
}

function updateAllAlerts() {
  updateTokenAlerts('gfm');
  updateTokenAlerts('pasternak');
}

// Initial update
updateAllAlerts();
// Update every 5 seconds
setInterval(updateAllAlerts, 5000);
</script>
</body>
</html>